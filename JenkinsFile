pipeline
  {
agent any
stages{
  stage ('Checkout')
      {
        steps
        {
        git branch: 'dev', credentialsId: '250d1e14-366e-4c0c-b43e-feb6651f0475', url: 'https://github.com/mukeshjoshi04/DevOps-Training/'
        }
      }

  stage ('Restore Nuget')
      {
        steps
        {
        	bat 'C:/Users/mukeshjoshi/Desktop/MyDocs/nuget.exe restore WebAppWithNunitTest.sln'
        }
      }

 stage('Build + SonarQube analysis') 
       {
        steps
        {
    
      SonarAnalysisStart()
      bat  "\"${tool 'MSBuild'}\" /t:Rebuild"
      SonarAnalysisStop()
        }
       }

   stage ('Test')
       {
       steps
        {
        bat "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\Common7\IDE\Extensions\TestPlatform\vstest.console.exe "NunitTest\bin\Debug\NunitTest.dll"
        }
      }
   }
}

def SonarAnalysisStart()
{
echo  "\u2600 **********Sonar analysis started*****************"
withSonarQubeEnv("sonarqubewebapp")
    {
    bat "\"${tool 'Sonarscanner'}\\SonarScanner.MSBuild.exe\" begin /key:mukeshiscool /n:MukeshJoshi /v:1.1.2"
    }
}

def SonarAnalysisStop()
{
echo  "\u2600 **********Sonar analysis ends*****************"
withSonarQubeEnv("sonarqubewebapp")
    {
    bat "\"${tool 'Sonarscanner'}\\SonarScanner.MSBuild.exe\" end"
    
    } 
}
