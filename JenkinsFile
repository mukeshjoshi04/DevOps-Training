pipeline
  {
stages{
  stage ('Checkout')
      {
        step
        {
        git branch: 'dev', credentialsId: '250d1e14-366e-4c0c-b43e-feb6651f0475', url: 'https://github.com/mukeshjoshi04/DevOps-Training/'
        }
      }

  stage ('Restore Nuget')
      {
        step
        {
        	bat 'Nuget.exe restore WebAppWithNunitTest.sln'
        }
      }

 stage('Build + SonarQube analysis') 
       {
        step
        {
    
      SonarAnalysisStart()
      bat  "\"${tool 'MSBuild'}\" /t:Rebuild"
      SonarAnalysisStop()
        }
       }

   stage ('Test')
       {
mstest
        step
        {
        bat "C:/Users/mukeshjoshi/Desktop/MyDocs/NUnit.Console-3.9.0/nunit3-console.exe   C:/Program Files (x86)/Jenkins/workspace/pipeline/WebAppWithNunitTest/NunitTest/bin/Debug/NunitTest.dll"
        }
      }
   }
}

def SonarAnalysisStart()
{
echo  "\u2600 **********Sonar analysis started*****************"
withSonarQubeEnv("sonarqubewebapp")
    {
    bat "\"${tool 'Sonarscanner'}\\SonarScanner.MSBuild.exe\" begin /key:mukeshiscool /n:MukeshJoshi /v:1.1.2"
    }
}

def SonarAnalysisStop()
{
echo  "\u2600 **********Sonar analysis ends*****************"
withSonarQubeEnv("sonarqube")
    {
    bat "\"${tool 'Sonarscanner'}\\SonarScanner.MSBuild.exe\" end"
    
    } 
}
