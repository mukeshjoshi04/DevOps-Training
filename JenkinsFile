pipeline
  {
agent any
stages{
  stage ('Restore Nuget')
      {
        steps
        {
        	bat 'C:/Users/mukeshjoshi/Desktop/MyDocs/nuget.exe restore WebAppWithNunitTest.sln'
        }
      }

 stage('Build + SonarQube analysis') 
       {
        steps
        {
    
      SonarAnalysisStart()
      bat  "\"${tool 'MSBuild'}\" /t:Rebuild"
      SonarAnalysisStop()
        }
       }

   stage ('Test')
       {
       steps
        {
        bat '"C:\\Users\\mukeshjoshi\\Desktop\\MyDocs\\NUnit.Console-3.9.0\\nunit3-console.exe" "C:/Program Files (x86)/Jenkins/workspace/pipeline/NunitTest/bin/Debug/NunitTest.dll"'
        }
      }
   }
}

def SonarAnalysisStart()
{
echo  "\u2600 **********Sonar analysis started*****************"
withSonarQubeEnv("sonarqubewebapp")
    {
    bat "\"${tool 'Sonarscanner'}\\SonarScanner.MSBuild.exe\" begin /key:mukeshiscool /n:MukeshJoshi /v:1.1.2"
    }
}

def SonarAnalysisStop()
{
echo  "\u2600 **********Sonar analysis ends*****************"
withSonarQubeEnv("sonarqubewebapp")
    {
    bat "\"${tool 'Sonarscanner'}\\SonarScanner.MSBuild.exe\" end"
    
    } 
}
